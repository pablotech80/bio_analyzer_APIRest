{% extends "base.html" %}

{% block title %}Nuevo análisis biométrico{% endblock %}
{% block content %}
<div class="container my-5">
	<div class="row">
		<div class="col-xl-8 col-lg-9 mx-auto">
			<div class="d-flex justify-content-between align-items-center mb-4">
				<div>
					<h1 class="h3 mb-1">Registro de análisis biométrico</h1>
					<p class="text-muted mb-0">Completa tus datos corporales para generar un informe detallado y guardarlo en tu historial.</p>
				</div>
				<a class="btn btn-outline-secondary rounded-pill btn-sm px-3 py-1 ms-3 historial-btn-responsive" href="{{ url_for('bioanalyze.history') }}">
					<i class="fas fa-history me-2"></i>Historial de análisis
				</a>
			</div>

			<form method="post" action="{{ url_for('bioanalyze.new_analysis') }}">
				{{ form.hidden_tag() }}

				<!-- Card: Datos personales -->
				<div class="card shadow-sm mb-4 rounded-4">
					<div class="card-header bg-light">
						<h2 class="h5 mb-0">Datos personales</h2>
					<div class="card-body">
						<div class="row g-3 align-items-end">
							<div class="col-12">
								{{ form.name.label(class="form-label") }}
								{{ form.name(class="form-control") }}
							</div>
						</div>
						<div class="row g-3 mt-2 align-items-end">
							<div class="col-12 col-md-4">
								{{ form.weight.label(class="form-label") }}
								{{ form.weight(class="form-control") }}
							</div>
							<div class="col-12 col-md-4">
								{{ form.height.label(class="form-label") }}
								{{ form.height(class="form-control") }}
							</div>
							<div class="col-12 col-md-4">
								{{ form.age.label(class="form-label") }}
								{{ form.age(class="form-control") }}
							</div>
						</div>
						<div class="row g-3 mt-2 align-items-end">
							<div class="col-12 col-md-6">
								{{ form.gender.label(class="form-label") }}
								{{ form.gender(class="form-select") }}
							</div>
							<div class="col-12 col-md-6">
								{{ form.activity_level.label(class="form-label") }}
								{{ form.activity_level(class="form-select") }}
							</div>
						</div>
					</div>
				</div>

				<!-- Card: Medidas corporales -->
				<div class="card shadow-sm mb-4 rounded-4">
					<div class="card-header bg-light">
						<h2 class="h5 mb-0">Medidas corporales</h2>
					<div class="card-body">
						<div class="row g-3">
							<div class="col-12 col-md-4">
								{{ form.neck.label(class="form-label") }}
								{{ form.neck(class="form-control") }}
							</div>
							<div class="col-12 col-md-4">
								{{ form.waist.label(class="form-label") }}
								{{ form.waist(class="form-control") }}
							</div>
							<div class="col-12 col-md-4">
								{{ form.hip.label(class="form-label") }}
								{{ form.hip(class="form-control") }}
							</div>
						</div>
						<div class="row g-3 mt-2">
							<div class="col-12 col-md-4">
								{{ form.biceps_left.label(class="form-label") }}
								{{ form.biceps_left(class="form-control") }}
							</div>
							<div class="col-12 col-md-4">
								{{ form.biceps_right.label(class="form-label") }}
								{{ form.biceps_right(class="form-control") }}
							</div>
							<div class="col-12 col-md-4">
								{{ form.thigh_left.label(class="form-label") }}
								{{ form.thigh_left(class="form-control") }}
							</div>
						</div>
						<div class="row g-3 mt-2">
							<div class="col-12 col-md-4">
								{{ form.thigh_right.label(class="form-label") }}
								{{ form.thigh_right(class="form-control") }}
							</div>
							<div class="col-12 col-md-4">
								{{ form.calf_left.label(class="form-label") }}
								{{ form.calf_left(class="form-control") }}
							</div>
							<div class="col-12 col-md-4">
								{{ form.calf_right.label(class="form-label") }}
								{{ form.calf_right(class="form-control") }}
							</div>
						</div>
					</div>
				</div>
				<!-- Card: Contexto y preferencias -->
				<div class="card shadow-sm mb-4 rounded-4">
					<div class="card-header bg-light">
						<h2 class="h5 mb-0">Contexto y preferencias</h2>
					</div>
					<div class="card-body">
						<div class="row g-3">
							<div class="col-md-6">
								{{ form.training_time.label(class="form-label") }}
								{{ form.training_time(class="form-control") }}
							</div>
							<div class="col-md-6">
								{{ form.training_preferences.label(class="form-label") }}
								{{ form.training_preferences(class="form-control") }}
							</div>
						</div>
						<div class="row g-3 mt-2">
							<div class="col-md-6">
								{{ form.fitness_experience.label(class="form-label") }}
								{{ form.fitness_experience(class="form-control") }}
							</div>
							<div class="col-md-6">
								{{ form.limitations.label(class="form-label") }}
								{{ form.limitations(class="form-control", rows="2") }}
							</div>
						</div>
						<div class="row g-3 mt-2">
							<div class="col-md-6">
								{{ form.motivations.label(class="form-label") }}
								{{ form.motivations(class="form-control", rows="2") }}
							</div>
							<div class="col-md-6">
								{{ form.diet_adherence.label(class="form-label") }}
								{{ form.diet_adherence(class="form-select") }}
							</div>
						</div>
						<div class="row g-3 mt-2">
							<div class="col-md-6">
								{{ form.food_preferences.label(class="form-label") }}
								{{ form.food_preferences(class="form-control", rows="2") }}
							</div>
							<div class="col-md-6">
								{{ form.supplements.label(class="form-label") }}
								{{ form.supplements(class="form-control", rows="2") }}
							</div>
						</div>
						<div class="row g-3 mt-2">
							<div class="col-md-6">
								{{ form.medication.label(class="form-label") }}
								{{ form.medication(class="form-control", rows="2") }}
							</div>
							<div class="col-md-6">
								{{ form.social_support.label(class="form-label") }}
								{{ form.social_support(class="form-select") }}
							</div>
						</div>
						<div class="row g-3 mt-2">
							<div class="col-md-6">
								{{ form.stress_level.label(class="form-label") }}
								{{ form.stress_level(class="form-control") }}
							</div>
							<div class="col-md-6">
								{{ form.sleep_quality.label(class="form-label") }}
								{{ form.sleep_quality(class="form-control") }}
							</div>
						</div>
					</div>
				</div>
				<div class="text-end mt-4">
					<button type="submit" class="btn btn-primary btn-lg rounded-pill w-100 w-md-auto">
						<i class="fas fa-calculator me-2"></i>Generar informe
					</button>
				</div>
			</form>
		</div>
	</div>
</div>
{% endblock %}
{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
	function toggleHipField() {
		var gender = document.querySelector('[name="gender"]').value;
		var hipField = document.querySelector('[name="hip"]').closest('.col-12, .col-md-4');
		if (gender === 'male') {
			hipField.style.display = 'none';
		} else {
			hipField.style.display = '';
		}
	}
	var genderSelect = document.querySelector('[name="gender"]');
	if (genderSelect) {
		genderSelect.addEventListener('change', toggleHipField);
		toggleHipField();
	}
});
</script>
{% endblock %}

{% block extra_css %}
<style>
	.historial-btn-responsive {
		font-size: 1rem;
		padding-left: 1.2rem;
		padding-right: 1.2rem;
		padding-top: 0.4rem;
		padding-bottom: 0.4rem;
		border-radius: 2rem;
		min-width: 120px;
		max-width: 100%;
		white-space: nowrap;
	}
	@media (max-width: 576px) {
		.historial-btn-responsive {
			font-size: 0.95rem;
			padding-left: 0.8rem;
			padding-right: 0.8rem;
			padding-top: 0.35rem;
			padding-bottom: 0.35rem;
			border-radius: 1.2rem;
			min-width: 90px;
		}
		.card .row.g-3 > [class^='col-'] {
			margin-bottom: 1rem;
		}
		.btn-lg {
			font-size: 1.1rem;
			padding: 0.8rem 1.2rem;
		}
	}
	@media (max-width: 768px) {
		.card .row.g-3 > [class^='col-'] {
			margin-bottom: 1rem;
		}
		.btn-lg {
			font-size: 1.15rem;
			padding: 0.9rem 1.5rem;
		}
	}
	.w-md-auto {
		width: auto !important;
	}
</style>
{% endblock %}
