{% extends "base.html" %}

{% block title %}Detalle de análisis{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row">
        <div class="col-xl-8 col-lg-9 mx-auto">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1 class="h3 mb-1">Detalle del análisis</h1>
                    <p class="text-muted mb-0">Generado el {{ analysis.created_at.strftime('%d/%m/%Y a las %H:%M') }}.</p>
                </div>
                <div>
                    <a class="btn btn-outline-secondary me-2" href="{{ url_for('bioanalyze.history') }}">
                        <i class="fas fa-history me-1"></i>Historial
                    </a>
                    <a class="btn btn-primary" href="{{ url_for('bioanalyze.informe_web') }}">
                        <i class="fas fa-redo me-1"></i>Nuevo análisis
                    </a>
                </div>
            </div>

            <div class="card shadow-sm mb-4">
                <div class="card-header bg-light">
                    <h2 class="h5 mb-0">Datos ingresados</h2>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-6 col-md-4">
                            <span class="text-muted d-block">Peso</span>
                            <strong>{{ '%.1f'|format(analysis.weight) }} kg</strong>
                        </div>
                        <div class="col-6 col-md-4">
                            <span class="text-muted d-block">Altura</span>
                            <strong>{{ '%.1f'|format(analysis.height) }} cm</strong>
                        </div>
                        <div class="col-6 col-md-4">
                            <span class="text-muted d-block">Edad</span>
                            <strong>{{ analysis.age }} años</strong>
                        </div>
                        <div class="col-6 col-md-4">
                            <span class="text-muted d-block">Género</span>
                            <strong>{{ 'Hombre' if analysis.gender == 'h' else 'Mujer' }}</strong>
                        </div>
                        <div class="col-6 col-md-4">
                            <span class="text-muted d-block">Cuello</span>
                            <strong>{{ '%.1f'|format(analysis.neck) }} cm</strong>
                        </div>
                        <div class="col-6 col-md-4">
                            <span class="text-muted d-block">Cintura</span>
                            <strong>{{ '%.1f'|format(analysis.waist) }} cm</strong>
                        </div>
                        {% if analysis.hip %}
                            <div class="col-6 col-md-4">
                                <span class="text-muted d-block">Cadera</span>
                                <strong>{{ '%.1f'|format(analysis.hip) }} cm</strong>
                            </div>
                        {% endif %}
                        <div class="col-6 col-md-4">
                            <span class="text-muted d-block">Actividad</span>
                            <strong>{{ analysis.activity_factor }}</strong>
                        </div>
                        {% if analysis.goal %}
                            <div class="col-6 col-md-4">
                                <span class="text-muted d-block">Objetivo</span>
                                <strong class="text-capitalize">{{ analysis.goal }}</strong>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="card shadow-sm mb-4">
                <div class="card-header bg-light">
                    <h2 class="h5 mb-0">Resultados principales</h2>
                </div>
                <div class="card-body">
                    <div class="row g-4">
                        <div class="col-md-6">
                            <h3 class="h6 text-uppercase text-muted">Composición corporal</h3>
                            <ul class="list-unstyled mb-0">
                                <li><strong>IMC:</strong> {{ '%.2f'|format(analysis.bmi) }}</li>
                                <li><strong>% Grasa:</strong> {{ '%.2f'|format(analysis.body_fat_percentage) }}%</li>
                                <li><strong>Masa magra:</strong> {{ '%.2f'|format(analysis.lean_mass) }} kg</li>
                                <li><strong>Masa grasa:</strong> {{ '%.2f'|format(analysis.fat_mass) }} kg</li>
                                <li><strong>FFMI:</strong> {{ '%.2f'|format(analysis.ffmi) }}</li>
                                <li><strong>Agua corporal:</strong> {{ '%.2f'|format(analysis.body_water) }} L</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h3 class="h6 text-uppercase text-muted">Metabolismo y ratios</h3>
                            <ul class="list-unstyled mb-0">
                                <li><strong>TMB:</strong> {{ '%.2f'|format(analysis.bmr) }} kcal</li>
                                <li><strong>TDEE:</strong> {{ '%.2f'|format(analysis.tdee) }} kcal</li>
                                <li><strong>Calorías objetivo:</strong> {{ '%.2f'|format(analysis.maintenance_calories) }} kcal</li>
                                <li><strong>Ratio cintura-altura:</strong> {{ '%.2f'|format(analysis.waist_height_ratio) }}</li>
                                {% if analysis.waist_hip_ratio %}
                                    <li><strong>RCC:</strong> {{ '%.2f'|format(analysis.waist_hip_ratio) }}</li>
                                {% endif %}
                                {% if analysis.metabolic_age %}
                                    <li><strong>Edad metabólica:</strong> {{ '%.0f'|format(analysis.metabolic_age) }}</li>
                                {% endif %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            {% if analysis.protein_grams or analysis.carbs_grams or analysis.fats_grams %}
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-light">
                        <h2 class="h5 mb-0">Macronutrientes recomendados</h2>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-md-4 mb-3 mb-md-0">
                                <span class="text-muted d-block">Proteínas</span>
                                <strong>{{ analysis.protein_grams and ('%.0f'|format(analysis.protein_grams)) or '—' }} g</strong>
                            </div>
                            <div class="col-md-4 mb-3 mb-md-0">
                                <span class="text-muted d-block">Carbohidratos</span>
                                <strong>{{ analysis.carbs_grams and ('%.0f'|format(analysis.carbs_grams)) or '—' }} g</strong>
                            </div>
                            <div class="col-md-4">
                                <span class="text-muted d-block">Grasas</span>
                                <strong>{{ analysis.fats_grams and ('%.0f'|format(analysis.fats_grams)) or '—' }} g</strong>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}

            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h2 class="h5 mb-0">Interpretaciones</h2>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        {% for label, descripcion in interpretaciones.items() %}
                            {% if descripcion %}
                                <li class="list-group-item">
                                    <strong class="text-capitalize">{{ label.replace('_', ' ') }}:</strong>
                                    <span class="d-block d-md-inline ms-md-2">{{ descripcion }}</span>
                                </li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
