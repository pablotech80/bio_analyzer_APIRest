{% extends 'base.html' %}
{% block title %}BioAnalyze | An√°lisis Detallado{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="text-center mb-4">
        <img src="{{ url_for('static', filename='img/bio_analyze.jpg') }}" alt="BioAnalyze Logo" width="120" class="rounded-circle mb-3">
        <h1 class="mt-2">An√°lisis Biom√©trico <span class="text-info">Completo</span></h1>
        <p class="lead">An√°lisis #{{ analysis.id }} - {{ analysis.created_at.strftime('%d/%m/%Y %H:%M') }}</p>
    </div>

    <div class="row">
        <!-- Columna Izquierda: Datos B√°sicos y M√©tricas -->
        <div class="col-lg-6">
            <div class="card mb-4">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">üìä Datos B√°sicos</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-6">
                            <p><strong>Peso:</strong> {{ analysis.weight }} kg</p>
                            <p><strong>Altura:</strong> {{ analysis.height }} cm</p>
                            <p><strong>Edad:</strong> {{ analysis.age }} a√±os</p>
                        </div>
                        <div class="col-6">
                            <p><strong>G√©nero:</strong> {{ 'Masculino' if analysis.gender == 'h' else 'Femenino' }}</p>
                            <p><strong>Objetivo:</strong> {{ analysis.goal or 'No especificado' }}</p>
                            <p><strong>Actividad:</strong> {{ analysis.activity_level or 'No especificado' }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mediciones Corporales -->
            <div class="card mb-4">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">üìè Mediciones Corporales</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-6">
                            <p><strong>Cuello:</strong> {{ analysis.neck }} cm</p>
                            <p><strong>Cintura:</strong> {{ analysis.waist }} cm</p>
                            {% if analysis.hip %}
                            <p><strong>Cadera:</strong> {{ analysis.hip }} cm</p>
                            {% endif %}
                        </div>
                        <div class="col-6">
                            {% if analysis.biceps %}
                            <p><strong>B√≠ceps:</strong> {{ analysis.biceps }} cm</p>
                            {% endif %}
                            {% if analysis.cuadriceps %}
                            <p><strong>Cu√°driceps:</strong> {{ analysis.cuadriceps }} cm</p>
                            {% endif %}
                            {% if analysis.gemelos %}
                            <p><strong>Gemelos:</strong> {{ analysis.gemelos }} cm</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">üî¢ M√©tricas Calculadas</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-6">
                            <p><strong>IMC:</strong> {{ "%.1f"|format(analysis.bmi) if analysis.bmi else 'N/A' }}</p>
                            <p><strong>% Grasa:</strong> {{ "%.1f"|format(analysis.body_fat_percentage) }}% if analysis.body_fat_percentage else 'N/A' }}</p>
                            <p><strong>TMB:</strong> {{ "%.0f"|format(analysis.bmr) }} kcal if analysis.bmr else 'N/A' }}</p>
                        </div>
                        <div class="col-6">
                            <p><strong>TDEE:</strong> {{ "%.0f"|format(analysis.tdee) }} kcal if analysis.tdee else 'N/A' }}</p>
                            <p><strong>Masa Magra:</strong> {{ "%.1f"|format(analysis.lean_mass) }} kg if analysis.lean_mass else 'N/A' }}</p>
                            <p><strong>FFMI:</strong> {{ "%.1f"|format(analysis.ffmi) if analysis.ffmi else 'N/A' }}</p>
                        </div>
                    </div>
                </div>
            </div>

            {% if interpretaciones %}
            <div class="card mb-4">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">üìã Interpretaciones B√°sicas</h5>
                </div>
                <div class="card-body">
                    {% for key, value in interpretaciones.items() %}
                        {% if value %}
                        <p><strong>{{ key.replace('_', ' ').title() }}:</strong> {{ value }}</p>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Columna Derecha: FitMaster AI -->
        <div class="col-lg-6">
            {% if ai_data and ai_data.interpretation %}
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">ü§ñ FitMaster AI - Interpretaci√≥n Profesional</h5>
                </div>
                <div class="card-body">
                    <p class="text-justify">{{ ai_data.interpretation }}</p>
                </div>
            </div>
            {% endif %}

            {% if ai_data and ai_data.nutrition_plan %}
            <div class="card mb-4">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">üçé Plan Nutricional AI</h5>
                </div>
                <div class="card-body">
                    <p><strong>Objetivo:</strong> {{ ai_data.nutrition_plan.goal }}</p>
                    <p><strong>Calor√≠as diarias:</strong> {{ ai_data.nutrition_plan.daily_calories }} kcal</p>

                    {% if ai_data.nutrition_plan.macros %}
                    <h6 class="mt-3">Macronutrientes:</h6>
                    <ul>
                        <li><strong>Prote√≠nas:</strong> {{ ai_data.nutrition_plan.macros.protein }}g</li>
                        <li><strong>Carbohidratos:</strong> {{ ai_data.nutrition_plan.macros.carbs }}g</li>
                        <li><strong>Grasas:</strong> {{ ai_data.nutrition_plan.macros.fat }}g</li>
                    </ul>
                    {% endif %}

                    {% if ai_data.nutrition_plan.meals %}
                    <h6 class="mt-3">Comidas Sugeridas:</h6>
                    {% for meal in ai_data.nutrition_plan.meals %}
                    <div class="mb-2">
                        <strong>{{ meal.name }}:</strong> {{ meal.description }}
                    </div>
                    {% endfor %}
                    {% endif %}
                </div>
            </div>
            {% endif %}

            {% if ai_data and ai_data.training_plan %}
            <div class="card mb-4">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0">üí™ Plan de Entrenamiento AI</h5>
                </div>
                <div class="card-body">
                    <p><strong>Frecuencia:</strong> {{ ai_data.training_plan.frequency }}</p>
                    <p><strong>Tipo de rutina:</strong> {{ ai_data.training_plan.routine_type }}</p>

                    {% if ai_data.training_plan.exercises %}
                    <h6 class="mt-3">Ejercicios Recomendados:</h6>
                    <ul>
                        {% for exercise in ai_data.training_plan.exercises %}
                        <li>{{ exercise }}</li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            {% if not ai_data or (not ai_data.interpretation and not ai_data.nutrition_plan and not ai_data.training_plan) %}
            <div class="card mb-4">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0">ü§ñ FitMaster AI</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted">No hay datos de FitMaster AI disponibles para este an√°lisis.</p>
                    <p class="small">Los an√°lisis m√°s recientes incluyen interpretaciones profesionales generadas por IA.</p>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Botones de Acci√≥n -->
    <div class="text-center mt-4">
        <a href="/historial" class="btn btn-outline-info me-2">üìã Ver Historial</a>
        <a href="/informe_web" class="btn btn-info">üîÑ Nuevo An√°lisis</a>
        <a href="/debug/{{ analysis.id }}" class="btn btn-outline-secondary">üîç Debug</a>
    </div>
</div>
{% endblock %}
