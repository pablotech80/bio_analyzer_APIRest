{% extends 'base.html' %}
{% block title %}BioAnalyze | Formulario{% endblock %}

{% block content %}
<div class="text-center mb-4">
    {% if error %}
    <div class="alert alert-danger text-center">{{ error }}</div>
    {% endif %}

    <img src="{{ url_for('static', filename='img/bio_analyze.jpg') }}" alt="BioAnalyze Logo" width="160" class="rounded-circle mb-3">
    <h1 class="mt-2">Bienvenido a <span class="text-info">Bio‚Ä¢Analyze</span></h1>
    <p class="lead">Ingresa tus datos f√≠sicos y biom√©tricos para obtener un informe detallado de tu composici√≥n corporal.<br>
    Utilizamos f√≥rmulas cient√≠ficas validadas con interpretaciones personalizadas por <strong>FitMaster AI</strong>.</p>
</div>

<form method="POST" action="/informe_web" class="row g-4">

    <!-- Datos Personales -->
    <div class="col-12">
        <h6 class="form-section-title border-bottom pb-1">üìã Datos Personales</h6>
    </div>

    <div class="col-12 col-md-3">
        <label for="edad" class="form-label">Edad</label>
        <input type="number" class="form-control" id="edad" name="edad" value="{{ form_data.get('edad', '') }}" required>
    </div>

    <div class="col-12 col-md-3">
        <label for="genero" class="form-label">G√©nero</label>
        <select class="form-select" id="genero" name="genero" required>
            <option value="">Seleccionar</option>
            <option value="h" {% if form_data.get('genero') == 'h' %}selected{% endif %}>Masculino</option>
            <option value="m" {% if form_data.get('genero') == 'm' %}selected{% endif %}>Femenino</option>
        </select>
    </div>

    <!-- Medidas Corporales -->
    <div class="col-12">
        <h6 class="form-section-title border-bottom pb-1">üìè Medidas Corporales</h6>
    </div>

    <div class="col-12 col-md-3">
        <label for="peso" class="form-label">Peso (kg)</label>
        <input type="number" step="0.1" class="form-control" id="peso" name="peso" value="{{ form_data.get('peso', '') }}" required>
    </div>

    <div class="col-12 col-md-3">
        <label for="altura" class="form-label">Altura (cm)</label>
        <input type="number" class="form-control" id="altura" name="altura" value="{{ form_data.get('altura', '') }}" required>
    </div>

    <div class="col-12 col-md-3">
        <label for="cuello" class="form-label">Cuello (cm)</label>
        <span data-bs-toggle="tooltip" title="Per√≠metro del cuello, medir justo debajo de la tr√°quea (punto m√°s estrecho).">
            <i class="bi bi-info-circle text-azul-logo"></i>
        </span>
        <input type="number" class="form-control" id="cuello" name="cuello" value="{{ form_data.get('cuello', '') }}" required>
    </div>

    <div class="col-12 col-md-3">
        <label for="cintura" class="form-label">Cintura (cm)</label>
        <span data-bs-toggle="tooltip" title="Per√≠metro de la cintura, medir en el punto m√°s estrecho del abdomen, generalmente cerca del ombligo.">
            <i class="bi bi-info-circle text-azul-logo"></i>
        </span>
        <input type="number" class="form-control" id="cintura" name="cintura" value="{{ form_data.get('cintura', '') }}" required>
    </div>

    <div class="col-12 col-md-3" id="grupo-cadera">
        <label for="cadera" class="form-label">Cadera (cm) <span class="text-muted">(solo mujeres)</span></label>
        <span data-bs-toggle="tooltip" title="Per√≠metro de la cadera, medir en la parte m√°s ancha de las caderas y gl√∫teos.">
            <i class="bi bi-info-circle text-azul-logo"></i>
        </span>
        <input type="number" class="form-control" id="cadera" name="cadera" value="{{ form_data.get('cadera', '') }}">
    </div>

    <!-- Medidas Musculares Opcionales -->
    <div class="col-12 mt-4">
        <h6 class="form-section-title border-bottom pb-1 text-info">
            üí™ Opcional: Medidas Musculares
        </h6>
        <p class="text-muted small">
            Estas medidas son opcionales y ayudan a obtener un an√°lisis m√°s detallado de la composici√≥n muscular.
        </p>
    </div>

    <div class="col-12 col-md-3">
        <label for="biceps" class="form-label">B√≠ceps (cm)</label>
        <span data-bs-toggle="tooltip" title="Per√≠metro del b√≠ceps en su punto m√°s ancho, con el brazo flexionado.">
            <i class="bi bi-info-circle text-azul-logo"></i>
        </span>
        <input type="number" step="0.1" class="form-control" id="biceps" name="biceps" value="{{ form_data.get('biceps', '') }}">
    </div>

    <div class="col-12 col-md-3">
        <label for="cuadriceps" class="form-label">Cu√°driceps (cm)</label>
        <span data-bs-toggle="tooltip" title="Per√≠metro del muslo en su punto m√°s ancho, generalmente a mitad del cu√°driceps.">
            <i class="bi bi-info-circle text-azul-logo"></i>
        </span>
        <input type="number" step="0.1" class="form-control" id="cuadriceps" name="cuadriceps" value="{{ form_data.get('cuadriceps', '') }}">
    </div>

    <div class="col-12 col-md-3">
        <label for="gemelos" class="form-label">Gemelos (cm)</label>
        <span data-bs-toggle="tooltip" title="Per√≠metro de la pantorrilla en su punto m√°s ancho.">
            <i class="bi bi-info-circle text-azul-logo"></i>
        </span>
        <input type="number" step="0.1" class="form-control" id="gemelos" name="gemelos" value="{{ form_data.get('gemelos', '') }}">
    </div>

    <!-- Nivel de Actividad F√≠sica -->
    <div class="col-12">
        <h6 class="form-section-title border-bottom pb-1">üî• Nivel de Actividad F√≠sica General</h6>
    </div>
    <div class="col-12 col-md-4">
        <label for="factor_actividad" class="form-label">
            Nivel de Actividad (FA)
            <span data-bs-toggle="tooltip" title="Considera tu actividad diaria completa: trabajo, desplazamientos y entrenamientos. Entrenar una hora no compensa 8-10 horas de sedentarismo.">
                <i class="bi bi-info-circle text-azul-logo"></i>
            </span>
        </label>
        <select id="factor_actividad" name="factor_actividad" class="form-select" required>
            <option value="">Seleccionar</option>
            <option value="1.2" {% if form_data.get('factor_actividad') == '1.2' %}selected{% endif %}>Sedentario (trabajo de oficina, poca actividad f√≠sica)</option>
            <option value="1.375" {% if form_data.get('factor_actividad') == '1.375' %}selected{% endif %}>Ligero (trabajo sedentario + 1-2 entrenamientos/semana)</option>
            <option value="1.55" {% if form_data.get('factor_actividad') == '1.55' %}selected{% endif %}>Moderado (vida activa + 3-5 entrenamientos/semana)</option>
            <option value="1.725" {% if form_data.get('factor_actividad') == '1.725' %}selected{% endif %}>Activo (trabajo f√≠sico o entrenos diarios)</option>
            <option value="1.9" {% if form_data.get('factor_actividad') == '1.9' %}selected{% endif %}>Muy activo (atleta, 2 entrenos/d√≠a o actividad muy exigente)</option>
        </select>
    </div>

    <!-- Objetivos -->
    <div class="col-12 mt-4">
        <h6 class="form-section-title border-bottom pb-1 text-info">
            üéØ Personalizaci√≥n con FitMaster AI
        </h6>
        <p class="text-muted small">
            Completa esta secci√≥n para recibir interpretaciones profesionales, planes nutricionales y rutinas de entrenamiento personalizadas generadas por inteligencia artificial.
        </p>
    </div>

    <div class="col-12 col-md-4">
        <label for="objetivo" class="form-label">Objetivo</label>
        <select class="form-select" id="objetivo" name="objetivo" required>
            <option value="">Seleccionar</option>
            <option value="mantener peso" {% if form_data.get('objetivo') == 'mantener peso' %}selected{% endif %}>Mantener peso</option>
            <option value="perder grasa" {% if form_data.get('objetivo') == 'perder grasa' %}selected{% endif %}>Perder grasa</option>
            <option value="ganar masa muscular" {% if form_data.get('objetivo') == 'ganar masa muscular' %}selected{% endif %}>Ganar masa muscular</option>
        </select>
    </div>

    <div class="col-12 col-md-4">
        <label for="nivel" class="form-label">
            Ajuste de Macronutrientes
            <span data-bs-toggle="tooltip" title="‚Ä¢ Saludable: Ajuste est√°ndar para salud & bienestar. ‚Ä¢ Fitness: Ajuste enfocado en composici√≥n corporal recreativa. ‚Ä¢ Competici√≥n: Ajuste avanzado para atletas que requieren control preciso de macros.">
                <i class="bi bi-info-circle text-azul-logo"></i>
            </span>
        </label>
        <select id="nivel" name="nivel" class="form-select" required>
            <option value="">Seleccionar</option>
            <option value="saludable" {% if form_data.get('nivel') == 'saludable' %}selected{% endif %}>Saludable (Bienestar general)</option>
            <option value="fitness" {% if form_data.get('nivel') == 'fitness' %}selected{% endif %}>Fitness Recreativo</option>
            <option value="competicion" {% if form_data.get('nivel') == 'competicion' %}selected{% endif %}>Atletas Competici√≥n</option>
        </select>
    </div>

    <!-- Ajustes Avanzados para Competici√≥n -->
    <div id="ajustes-competicion" class="row g-3 mt-4" style="display: none;">
        <fieldset>
            <legend class="form-section-title border-bottom pb-1">Ajustes de Macronutrientes Atletas Competici√≥n</legend>

            <div class="col-12 col-md-4">
                <label for="proteinas_kg" class="form-label">
                    Prote√≠nas (g/kg)
                    <span data-bs-toggle="tooltip" title="Gramos de prote√≠na por kilogramo de peso corporal.">
                        <i class="bi bi-info-circle text-azul-logo"></i>
                    </span>
                </label>
                <input type="number" id="proteinas_kg" name="proteinas_kg" step="0.01" class="form-control" value="{{ form_data.get('proteinas_kg', '') }}">
            </div>

            <div class="col-12 col-md-4">
                <label for="carbohidratos_kg" class="form-label">
                    Carbohidratos (g/kg)
                    <span data-bs-toggle="tooltip" title="Gramos de carbohidrato por kilogramo de peso corporal.">
                        <i class="bi bi-info-circle text-azul-logo"></i>
                    </span>
                </label>
                <input type="number" id="carbohidratos_kg" name="carbohidratos_kg" step="0.01" class="form-control" value="{{ form_data.get('carbohidratos_kg', '') }}">
            </div>

            <div class="col-12 col-md-4">
                <label for="grasas_kg" class="form-label">
                    Grasas (g/kg)
                    <span data-bs-toggle="tooltip" title="Gramos de grasa por kilogramo de peso corporal.">
                        <i class="bi bi-info-circle text-azul-logo"></i>
                    </span>
                </label>
                <input type="number" id="grasas_kg" name="grasas_kg" step="0.01" class="form-control" value="{{ form_data.get('grasas_kg', '') }}">
            </div>
        </fieldset>
    </div>

    <!-- Botones -->
    <div class="col-12 text-center mt-4">
        <button type="submit" class="btn btn-info px-4 rounded-pill">ü§ñ Analizar con FitMaster AI</button>
        <a href="/informe_web" class="btn btn-outline-light ms-2 rounded-pill">Limpiar datos</a>
    </div>
</form>

<!-- JavaScript -->
<script>
document.getElementById('nivel').addEventListener('change', function() {
    var ajustes = document.getElementById('ajustes-competicion');
    if (this.value === 'competicion') {
        ajustes.style.display = 'block';
    } else {
        ajustes.style.display = 'none';
    }
});

// Mostrar/ocultar campo cadera seg√∫n g√©nero
document.getElementById('genero').addEventListener('change', function() {
    var grupoCadera = document.getElementById('grupo-cadera');
    var inputCadera = document.getElementById('cadera');

    if (this.value === 'm') {
        grupoCadera.style.display = 'block';
        inputCadera.required = true;
    } else {
        grupoCadera.style.display = 'none';
        inputCadera.required = false;
        inputCadera.value = '';
    }
});

// Ejecutar al cargar la p√°gina
document.addEventListener('DOMContentLoaded', function() {
    var genero = document.getElementById('genero').value;
    var grupoCadera = document.getElementById('grupo-cadera');
    var inputCadera = document.getElementById('cadera');

    if (genero !== 'm') {
        grupoCadera.style.display = 'none';
        inputCadera.required = false;
    }
});
</script>

{% endblock %}
